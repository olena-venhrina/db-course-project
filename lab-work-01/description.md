# Робота з dbdoc.io

## Крок 1. Встановлення dbdocs CLI та вхід в акаунт

1. Необхідно встановити Node.js якщо він не встановлений. Знайти його можна за посиланням https://nodejs.org/uk . Потрібен інсталятор Windows (файл .msi)
2. У командному рядку Windows виконайте команду `npm install -g dbdocs`. Цим самим ви встановите  dbdocs глобально для свого комп'ютера.
3. Авторизуйтесь за допомогою команди `dbdocs login`. Після її запуску система вас запитає, яким саме способом ви бажаєте авторизуватись.  Оберіть GitHub
4. Після цього з'явиться вікно в якому можна буде скопіювати токен - довгий рядок. Скопіюйте його в термінал для завершення реєстрації і окремо збережіть у текстовому файлі.

Результат: ви встановили dbdocs на свій комп'ютер і згенерували токен доступу для сервісу. Це єдиний спосіб отримати токен і використовувати цей сервіс.

## Крок 2. Додавання токену в секрети GitHub

Токен не можна просто так вставляти у файли конфігурації. Його потрібно безпечно зберегти в налаштуваннях репозиторію. Для цього виконайте наступні дії:

1. Перейдіть у свій репозиторій на GitHub.
2. Відкрийте вкладку **Settings** > **Secrets and variables** > **Actions**.
3. Натисніть кнопку **New repository secret**.
4. У полі **Name** введіть `DBDOCS_TOKEN`.
5. У полі **Secret** вставте скопійований раніше токен.
6. Натисніть **Add secret**.

## Крок 3. Створення файлу GitHub Actions

Це головний крок. На ньому ви створите файл, який описує, що саме GitHub має робити при кожному оновленні файлу схеми. Для цього:

1. У корені свого репозиторію створіть папку `.github`, а в ній – папку `workflows`, в якій створіть новий файл, наприклад, `publish-dbdocs.yml`.
2. Вставте у цей файл такий код:
```yaml
name: Publish DB Docs

# Цей воркфлоу буде запускатись при кожному пуші у гілку 'main'
on:
  push:
    branches:
      - main # Можеш змінити на свою основну гілку, наприклад 'master'

jobs:
  publish:
    runs-on: ubuntu-latest # Використовуємо віртуальну машину на Ubuntu

    steps:
      # 1. Клонуємо репозиторій, щоб отримати доступ до .dbml файлу
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Встановлюємо Node.js, який потрібен для роботи dbdocs
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18' # Версія Node.js

      # 3. Встановлюємо сам dbdocs CLI
      - name: Install dbdocs
        run: npm install -g dbdocs

      # 4. Публікуємо документацію
      - name: Build and publish dbdocs
        env:
          DBDOCS_TOKEN: ${{ secrets.DBDOCS_TOKEN }} # Використовуємо наш секретний токен
        run: dbdocs build lab-work-01/schema-venhrina.dbml --project "coffee-specialty-shop"
        # Обов'язково вкажи правильний шлях до твого файлу
        # та назву проєкту на dbdocs.io відповідно до варіанту
```
>[!Note]
>На момент створення скрипта (yaml-файлу) вашого проєкту не існує. Він буде створений після запуску цього файлу. Тому назвіть його як бажаєте, відповідно до вашого варіанту.

3. Після збереження цього файлу, відбудеться запуск потоку, який створить проєкт на dbdocs.io і опублікує сайт.  Для перевірки успішності його роботи перейдіть на вкладку **Actions** і перегляньте стан потоку Update publish-dbdocs.yml
4. Якщо біля нього піктограма зеленого кольору, то все добре і перейдіть на п. 7. Якщо красного кольору, то натисніть на цей потік і в меню ліворуч натисніть на **publish**.
5. Перегляньте лог і розкрийте пункт, я кому відбулась помилка. Скоріше за все, проблема з токеном. Для її виправлення, відкрийте командний рядок на своєму комп'ютері і виконайте команду `dbdocs token -g`. Вона згенерує новий токен, який треба буде уважно виділити і скопіювати.
6. Перейдіть до файлу з секретом і відкрийте його для редагування. Уважно вставте токен і збережіть файл. Після цього потік повинен запуститись. Вже відомим вам способом перегляньте його стан.
7. Натисніть на назву потоку і в меню ліворуч натисніть на **publish**. Перегляньте лог і знайдіть пункт **Build and publish dbdocs**. Розкрийте його і знайдіть рядок типу

✔ Done. Visit: [https://dbdocs.io/olena.venhrina/coffee-specialty-shop](https://dbdocs.io/olena.venhrina/coffee-specialty-shop) 

Це і є посилання на ваш сайт з документацією. 

## Результат

Результатом цієї роботи є простий  CI/CD пайплайн, який оновлюватиме вашу схему автоматично після внесення змін в її файл на GitHub.


